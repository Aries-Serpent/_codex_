# Module Scan Results

## Tokenisation
- src/codex_ml/tokenization/__init__.py
- src/codex_ml/tokenization/hf_tokenizer.py
- src/codex_ml/tokenization/sentencepiece_adapter.py

## Modelling
- src/codex_ml/models/minilm.py
- src/codex_ml/modeling/codex_model_loader.py
- src/codex_ml/peft/peft_adapter.py

## Training
- src/codex_ml/train_loop.py
- src/codex_ml/training/callbacks.py
- functional_training.py

## Evaluation
- src/codex_ml/eval/evaluator.py
- src/codex_ml/eval/metrics.py

## Monitoring
- src/codex_ml/monitoring/codex_logging.py

## Checkpointing
- src/codex_ml/utils/checkpointing.py
- training/checkpoint_manager.py

## Capability Mapping
- `apply_lora` â†’ LoRA integration (`src/codex_ml/peft/peft_adapter.py`)
- `HFTokenizerAdapter` â†’ tokenisation (`src/codex_ml/tokenization/hf_tokenizer.py`)
- `MiniLM` â†’ demo model (`src/codex_ml/models/minilm.py`)
- `codex_train_step` â†’ training step w/grad accumulation (`functional_training.py`)
- `Evaluator` â†’ evaluation loop (`src/codex_ml/eval/evaluator.py`)
- `CodexLoggers` â†’ monitoring (`src/codex_ml/monitoring/codex_logging.py`)
- `CheckpointManager` â†’ checkpoint handling (`training/checkpoint_manager.py`)

## Missing / To Do
- CLI entry point via Hydra
- Metrics callback with NDJSON support
- Coverage gating in nox
- Lockfile via `pip-compile --generate-hashes`
- Tests for new features

## Quality Checks
### pre-commit
```
black....................................................................[42mPassed[m
ruff.....................................................................[41mFailed[m
[2m- hook id: ruff[m
[2m- files were modified by this hook[m

Found 1 error (1 fixed, 0 remaining).

isort....................................................................[41mFailed[m
[2m- hook id: isort[m
[2m- files were modified by this hook[m

Fixing /workspace/_codex_/functional_training.py

fix end of files.........................................................[42mPassed[m
trim trailing whitespace.................................................[42mPassed[m
```

### pytest
```

============================================================ ERRORS ============================================================
____________________________________ ERROR collecting tests/test_ingestion_auto_encoding.py ____________________________________
ImportError while importing test module '/workspace/_codex_/tests/test_ingestion_auto_encoding.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/root/.pyenv/versions/3.12.10/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_ingestion_auto_encoding.py:10: in <module>
    from ingestion import Ingestor  # noqa: E402
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ImportError: cannot import name 'Ingestor' from 'ingestion' (/workspace/_codex_/src/ingestion/__init__.py)
__________________________________ ERROR collecting tests/test_ingestion_encodings_matrix.py ___________________________________
ImportError while importing test module '/workspace/_codex_/tests/test_ingestion_encodings_matrix.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/root/.pyenv/versions/3.12.10/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_ingestion_encodings_matrix.py:10: in <module>
    from ingestion import Ingestor  # noqa: E402
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ImportError: cannot import name 'Ingestor' from 'ingestion' (/workspace/_codex_/src/ingestion/__init__.py)
___________________________________ ERROR collecting tests/test_ingestion_family_encoding.py ___________________________________
ImportError while importing test module '/workspace/_codex_/tests/test_ingestion_family_encoding.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/root/.pyenv/versions/3.12.10/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_ingestion_family_encoding.py:11: in <module>
    from ingestion.csv_ingestor import load_csv  # noqa: E402
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/ingestion/csv_ingestor.py:7: in <module>
    from .utils import _detect_encoding
E   ImportError: cannot import name '_detect_encoding' from 'ingestion.utils' (/workspace/_codex_/src/ingestion/utils.py). Did you mean: 'detect_encoding'?
_________________________________________ ERROR collecting tests/test_ingestion_io.py __________________________________________
ImportError while importing test module '/workspace/_codex_/tests/test_ingestion_io.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/root/.pyenv/versions/3.12.10/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_ingestion_io.py:12: in <module>
    from ingestion import Ingestor, ingest  # noqa: E402
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ImportError: cannot import name 'Ingestor' from 'ingestion' (/workspace/_codex_/src/ingestion/__init__.py)
______________________________________ ERROR collecting tests/test_ingestion_read_text.py ______________________________________
ImportError while importing test module '/workspace/_codex_/tests/test_ingestion_read_text.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/root/.pyenv/versions/3.12.10/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_ingestion_read_text.py:4: in <module>
    from ingestion.utils import read_text
E   ImportError: cannot import name 'read_text' from 'ingestion.utils' (/workspace/_codex_/src/ingestion/utils.py)
_____________________________________ ERROR collecting tests/tracking/test_mlflow_utils.py _____________________________________
import file mismatch:
imported module 'test_mlflow_utils' has this __file__ attribute:
  /workspace/_codex_/tests/monitoring/test_mlflow_utils.py
which is not the same as the test file we want to collect:
  /workspace/_codex_/tests/tracking/test_mlflow_utils.py
HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules
=================================================== short test summary info ====================================================
ERROR tests/test_ingestion_auto_encoding.py
ERROR tests/test_ingestion_encodings_matrix.py
ERROR tests/test_ingestion_family_encoding.py
ERROR tests/test_ingestion_io.py
ERROR tests/test_ingestion_read_text.py
ERROR tests/tracking/test_mlflow_utils.py
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 6 errors during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
1 skipped, 6 errors in 11.54s
```

## pytest -q --maxfail=1
```

# Validation 2025-08-26T15:35:50.872437Z

## python -m compileall .
````
Listing '.'...
Listing './.codex'...
Listing './.codex/automation_out'...
Compiling './.codex/codex_repo_scout.py'...
Listing './.codex/hydra_last'...
Compiling './.codex/run_db_utils_workflow.py'...
Compiling './.codex/run_repo_scout.py'...
Compiling './.codex/run_workflow.py'...
Listing './.codex/smoke'...
Compiling './.codex/smoke/import_check.py'...
Listing './.git'...
Listing './.git/branches'...
Listing './.git/hooks'...
Listing './.git/info'...
Listing './.git/lfs'...
Listing './.git/lfs/objects'...
Listing './.git/lfs/objects/0f'...
Listing './.git/lfs/objects/0f/42'...
Listing './.git/lfs/objects/5e'...
Listing './.git/lfs/objects/5e/c7'...
Listing './.git/lfs/objects/70'...
Listing './.git/lfs/objects/70/db'...
Listing './.git/lfs/objects/86'...
Listing './.git/lfs/objects/86/94'...
Listing './.git/lfs/tmp'...
Listing './.git/logs'...
Listing './.git/logs/refs'...
Listing './.git/logs/refs/heads'...
Listing './.git/logs/refs/remotes'...
Listing './.git/objects'...
Listing './.git/objects/info'...
Listing './.git/objects/pack'...
Listing './.git/refs'...
Listing './.git/refs/heads'...
Listing './.git/refs/remotes'...
Listing './.git/refs/tags'...
Listing './.github'...
Listing './.github/workflows'...
Listing './LICENSES'...
Listing './artifacts'...
Listing './artifacts/metrics'...
Listing './codex_ml'...
Listing './codex_ml/tracking'...
Compiling './codex_ml/tracking/mlflow_utils.py'...
Listing './codex_ml/utils'...
Compiling './codex_ml/utils/checkpointing.py'...
Compiling './codex_script.py'...
***   File "./codex_script.py", line 182
    _REGISTRY: Dict[str, Callable] = {}
                                      ^
SyntaxError: f-string: valid expression required before '}'

Compiling './codex_setup.py'...
Compiling './codex_workflow.py'...
Listing './configs'...
Listing './configs/env'...
Listing './configs/training'...
Listing './db'...
Listing './deploy'...
Listing './deploy/helm'...
Compiling './deploy_codex_pipeline.py'...
Listing './docs'...
Listing './docs/architecture'...
Listing './docs/examples'...
Listing './docs/model_cards'...
Listing './docs/ops'...
Listing './docs/tutorials'...
Listing './documentation'...
Compiling './documentation/codex_symbolic_pipeline.py'...
Listing './examples'...
Listing './examples/notebooks'...
Compiling './functional_training.py'...
Listing './notebooks'...
Compiling './noxfile.py'...
Listing './requirements'...
Listing './scripts'...
Compiling './scripts/apply_session_logging_workflow.py'...
Compiling './scripts/benchmark_logging.py'...
Compiling './scripts/codex_end_to_end.py'...
Compiling './scripts/deep_research_task_process.py'...
Listing './scripts/deploy'...
Compiling './scripts/deploy_codex_pipeline.py'...
Listing './scripts/env'...
Compiling './scripts/env/print_env_info.py'...
Listing './scripts/gpu'...
Compiling './scripts/init_sample_db.py'...
Listing './services'...
Listing './services/api'...
Compiling './services/api/__init__.py'...
Compiling './services/api/main.py'...
***   File "./services/api/main.py", line 55
    f"epoch {e + 1} done
    ^
SyntaxError: unterminated f-string literal (detected at line 55)

Listing './src'...
Compiling './src/__init__.py'...
Listing './src/codex'...
Compiling './src/codex/__init__.py'...
Compiling './src/codex/chat.py'...
Compiling './src/codex/cli.py'...
Listing './src/codex/db'...
Compiling './src/codex/db/sqlite_patch.py'...
Listing './src/codex/logging'...
Compiling './src/codex/logging/__init__.py'...
Compiling './src/codex/logging/config.py'...
Compiling './src/codex/logging/conversation_logger.py'...
Compiling './src/codex/logging/db_utils.py'...
Compiling './src/codex/logging/export.py'...
Compiling './src/codex/logging/fetch_messages.py'...
Compiling './src/codex/logging/import_ndjson.py'...
Compiling './src/codex/logging/query_logs.py'...
Compiling './src/codex/logging/session_hooks.py'...
Compiling './src/codex/logging/session_logger.py'...
Compiling './src/codex/logging/session_query.py'...
Compiling './src/codex/logging/viewer.py'...
Listing './src/codex/monkeypatch'...
Compiling './src/codex/monkeypatch/log_adapters.py'...
Listing './src/codex/utils'...
Compiling './src/codex/utils/__init__.py'...
Compiling './src/codex/utils/subprocess.py'...
Listing './src/codex_ml'...
Compiling './src/codex_ml/__init__.py'...
Listing './src/codex_ml/cli'...
Compiling './src/codex_ml/cli/main.py'...
Compiling './src/codex_ml/config.py'...
Listing './src/codex_ml/data'...
Compiling './src/codex_ml/data/__init__.py'...
Compiling './src/codex_ml/data/cache.py'...
Compiling './src/codex_ml/data/cli.py'...
Compiling './src/codex_ml/data/loaders.py'...
Compiling './src/codex_ml/data/sharding.py'...
Listing './src/codex_ml/eval'...
Compiling './src/codex_ml/eval/metrics.py'...
Listing './src/codex_ml/interfaces'...
Compiling './src/codex_ml/interfaces/__init__.py'...
Compiling './src/codex_ml/interfaces/reward_model.py'...
Compiling './src/codex_ml/interfaces/rl.py'...
Compiling './src/codex_ml/interfaces/tokenizer.py'...
Listing './src/codex_ml/metrics'...
Compiling './src/codex_ml/metrics/__init__.py'...
Compiling './src/codex_ml/metrics/curves.py'...
Compiling './src/codex_ml/metrics/text.py'...
Listing './src/codex_ml/models'...
Compiling './src/codex_ml/models/__init__.py'...
Compiling './src/codex_ml/models/activations.py'...
Compiling './src/codex_ml/models/minilm.py'...
Listing './src/codex_ml/monitoring'...
Compiling './src/codex_ml/monitoring/__init__.py'...
Compiling './src/codex_ml/monitoring/prometheus.py'...
Listing './src/codex_ml/peft'...
Compiling './src/codex_ml/peft/__init__.py'...
Compiling './src/codex_ml/peft/peft_adapter.py'...
Compiling './src/codex_ml/pipeline.py'...
Listing './src/codex_ml/safety'...
Compiling './src/codex_ml/safety/__init__.py'...
Compiling './src/codex_ml/safety/filters.py'...
Compiling './src/codex_ml/safety/risk_score.py'...
Compiling './src/codex_ml/safety/sandbox.py'...
Compiling './src/codex_ml/symbolic_pipeline.py'...
Listing './src/codex_ml/tokenization'...
Compiling './src/codex_ml/tokenization/__init__.py'...
Compiling './src/codex_ml/tokenization/hf_tokenizer.py'...
Compiling './src/codex_ml/tokenization/sentencepiece_adapter.py'...
Listing './src/codex_ml/tracking'...
Compiling './src/codex_ml/tracking/__init__.py'...
Compiling './src/codex_ml/tracking/cli.py'...
Compiling './src/codex_ml/tracking/git_tag.py'...
Compiling './src/codex_ml/tracking/mlflow_utils.py'...
Compiling './src/codex_ml/train_loop.py'...
Listing './src/codex_ml/training'...
Compiling './src/codex_ml/training/__init__.py'...
Compiling './src/codex_ml/training/callbacks.py'...
Listing './src/codex_ml/utils'...
Compiling './src/codex_ml/utils/__init__.py'...
Compiling './src/codex_ml/utils/checkpointing.py'...
Compiling './src/codex_ml/utils/checksums.py'...
Listing './src/ingestion'...
Compiling './src/ingestion/__init__.py'...
Compiling './src/ingestion/csv_ingestor.py'...
Compiling './src/ingestion/encoding_detect.py'...
Compiling './src/ingestion/file_ingestor.py'...
Compiling './src/ingestion/json_ingestor.py'...
Compiling './src/ingestion/utils.py'...
Listing './tests'...
Compiling './tests/__init__.py'...
Compiling './tests/_codex_introspect.py'...
Listing './tests/smoke'...
Compiling './tests/smoke/test_hf_trainer_hello.py'...
Compiling './tests/smoke/test_logging_flags_end_to_end.py'...
Compiling './tests/smoke/test_mlflow_utils_noop.py'...
Compiling './tests/test_activations.py'...
Compiling './tests/test_chat_env_cleanup.py'...
Compiling './tests/test_chat_session.py'...
Compiling './tests/test_chat_session_exit.py'...
Compiling './tests/test_checkpoint_roundtrip.py'...
Compiling './tests/test_cli.py'...
Compiling './tests/test_codex_cli.py'...
Compiling './tests/test_codex_maintenance.py'...
Compiling './tests/test_conversation_logger.py'...
Compiling './tests/test_data_cache_sharding.py'...
Compiling './tests/test_db_utils.py'...
Compiling './tests/test_db_utils_table_name.py'...
Compiling './tests/test_deep_research_task_process.py'...
Compiling './tests/test_deploy_codex_pipeline.py'...
Compiling './tests/test_engine_hf_trainer.py'...
Compiling './tests/test_export.py'...
Compiling './tests/test_fetch_messages.py'...
Compiling './tests/test_fetch_messages_missing_db.py'...
Compiling './tests/test_import_codex.py'...
Compiling './tests/test_import_ndjson.py'...
Compiling './tests/test_import_ndjson_cli.py'...
Compiling './tests/test_import_ndjson_dedup.py'...
Compiling './tests/test_ingestion_auto_encoding.py'...
Compiling './tests/test_ingestion_encoding_coverage.py'...
Compiling './tests/test_ingestion_encodings_matrix.py'...
Compiling './tests/test_ingestion_family_encoding.py'...
Compiling './tests/test_ingestion_io.py'...
Compiling './tests/test_interfaces_compat.py'...
Compiling './tests/test_loaders.py'...
Compiling './tests/test_log_adapters.py'...
Compiling './tests/test_logging_viewer_cli.py'...
Compiling './tests/test_metric_curves.py'...
Compiling './tests/test_metrics.py'...
Compiling './tests/test_metrics_tb.py'...
Compiling './tests/test_minilm_forward.py'...
Compiling './tests/test_mlflow_utils.py'...
Compiling './tests/test_monitoring_thread.py'...
Compiling './tests/test_ndjson_db_parity.py'...
Compiling './tests/test_parse_when.py'...
Compiling './tests/test_precommit_config_exists.py'...
Compiling './tests/test_query_logs_build_query.py'...
Compiling './tests/test_query_logs_tail.py'...
Compiling './tests/test_readme_examples.py'...
Compiling './tests/test_repo_option_a.py'...
Compiling './tests/test_repo_option_b.py'...
Compiling './tests/test_resume.py'...
Compiling './tests/test_safety.py'...
Compiling './tests/test_sentencepiece_adapter.py'...
Compiling './tests/test_session_hooks.py'...
Compiling './tests/test_session_hooks_warnings.py'...
Compiling './tests/test_session_logger_log_adapters.py'...
Compiling './tests/test_session_logging.py'...
Compiling './tests/test_session_logging_mirror.py'...
Compiling './tests/test_session_query_cli.py'...
Compiling './tests/test_session_query_smoke.py'...
Compiling './tests/test_sqlite_pool.py'...
Compiling './tests/test_sqlite_pool_close.py'...
Compiling './tests/test_sqlite_sanitize.py'...
Compiling './tests/test_symbolic_pipeline.py'...
Compiling './tests/test_tokenization.py'...
Listing './tools'...
Compiling './tools/__init__.py'...
Compiling './tools/apply_ci_precommit.py'...
Compiling './tools/apply_container_api.py'...
Compiling './tools/apply_data_loaders.py'...
Compiling './tools/apply_docs.py'...
Compiling './tools/apply_hydra_scaffold.py'...
Compiling './tools/apply_interfaces.py'...
***   File "./tools/apply_interfaces.py", line 279
    assert agent.act({}) == 1
                      ^
SyntaxError: f-string: valid expression required before '}'

Compiling './tools/apply_ml_metrics.py'...
Compiling './tools/apply_mlflow_tracking.py'...
Compiling './tools/apply_pyproject_packaging.py'...
Compiling './tools/apply_safety.py'...
Compiling './tools/apply_stack_polish.py'...
Compiling './tools/auto_analyze_errors.py'...
Compiling './tools/build_sqlite_snapshot.py'...
Compiling './tools/codex_agents_workflow.py'...
Compiling './tools/codex_apply_modeling_monitoring_api.py'...
Compiling './tools/codex_cli.py'...
Compiling './tools/codex_exec.py'...
Compiling './tools/codex_import_normalizer.py'...
Compiling './tools/codex_ingestion_workflow.py'...
Compiling './tools/codex_logging_workflow.py'...
Compiling './tools/codex_maintenance.py'...
Compiling './tools/codex_make_smoke_tests.py'...
Compiling './tools/codex_patch_exec.py'...
Compiling './tools/codex_patch_session_logging.py'...
Compiling './tools/codex_precommit_bootstrap.py'...
Compiling './tools/codex_session_logging_workflow.py'...
Compiling './tools/codex_sqlite_align.py'...
Compiling './tools/codex_src_consolidation.py'...
Compiling './tools/codex_supplied_task_runner.py'...
Compiling './tools/codex_workflow_session_query.py'...
Compiling './tools/export_to_parquet.py'...
Compiling './tools/git_patch_parser_complete.py'...
Compiling './tools/monitoring_integrate.py'...
Compiling './tools/purge_session_logs.py'...
Compiling './tools/run_supplied_task.py'...
Compiling './tools/test_auto_analyze_errors.py'...
Compiling './tools/unify_logging_canonical.py'...
Compiling './tools/verify_data_paths.py'...
Compiling './tools/workflow_merge.py'...
Listing './training'...
Compiling './training/engine_hf_trainer.py'...
***   File "./training/engine_hf_trainer.py", line 199
    eval_dataset=val_ds,
    ^^^^^^^^^^^^^^^^^^^
SyntaxError: keyword argument repeated: eval_dataset

./tools/codex_supplied_task_runner.py:138: SyntaxWarning: invalid escape sequence '\.'
  Get-ChildItem .\.codex\sessions -File | Where-Object { $_.LastWriteTime -lt (Get-Date).AddDays(-30) } | Remove-Item -Force

(exit=1)
````

## pytest -q -k smoke --maxfail=1
````

============================================================ ERRORS ============================================================
_____________________________________ ERROR collecting tests/test_deploy_codex_pipeline.py _____________________________________
/root/.pyenv/versions/3.12.10/lib/python3.12/site-packages/_pytest/python.py:498: in importtestmodule
    mod = import_path(
/root/.pyenv/versions/3.12.10/lib/python3.12/site-packages/_pytest/pathlib.py:587: in import_path
    importlib.import_module(module_name)
/root/.pyenv/versions/3.12.10/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap>:1387: in _gcd_import
    ???
<frozen importlib._bootstrap>:1360: in _find_and_load
    ???
<frozen importlib._bootstrap>:1331: in _find_and_load_unlocked
    ???
<frozen importlib._bootstrap>:935: in _load_unlocked
    ???
/root/.pyenv/versions/3.12.10/lib/python3.12/site-packages/_pytest/assertion/rewrite.py:186: in exec_module
    exec(co, module.__dict__)
tests/test_deploy_codex_pipeline.py:6: in <module>
    from scripts.deploy_codex_pipeline import main
scripts/deploy_codex_pipeline.py:44: in <module>
    from training.engine_hf_trainer import run_hf_trainer
E     File "/workspace/_codex_/training/engine_hf_trainer.py", line 199
E       eval_dataset=val_ds,
E       ^^^^^^^^^^^^^^^^^^^
E   SyntaxError: keyword argument repeated: eval_dataset
=================================================== short test summary info ====================================================
