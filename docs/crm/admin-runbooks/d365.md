# Dynamics 365 Admin Runbook

Offline-first scaffolds for Dynamics 365 administrators mirror the Zendesk
workflow. This guide highlights environment validation and safe dry-run apply
behavior.

## Environment
Set local variables (no outbound auth performed by default):
```bash
export D365_URL=https://org.crm.dynamics.com
export D365_TENANT_ID=...
export D365_CLIENT_ID=...
export D365_CLIENT_SECRET=...
```

Validate:
```bash
python -m codex.cli d365 env-check
```

## Snapshot & Dry-run Apply
```bash
python -m codex.cli d365 snapshot artifacts/d365_snapshot.json
python -m codex.cli zendesk plan diff.json > plan.json
python -m codex.cli d365 apply plan.json --dry-run
```

Snapshots capture local Config-as-Data (for example CSVs under `config/d365`)
and the dry-run `apply` command prints the operations payload for review while
writing JSONL evidence for routing/SLA operations to `.codex/evidence/`.

## Emit Solution XML (offline)
```bash
python -m codex.cli d365 emit-solution-xml --name CodexCRM --version 1.0.0.0 --out artifacts/Solution.xml
```

The emitter reads `config/d365/solution_manifest.json` and produces an unmanaged
`Solution.xml` that can be bundled with future `Customizations.xml` artifacts.

## Apply stubs & evidence trails
```bash
# SLA operations (append-only evidence)
python -m codex.cli d365 apply-slas plan_slas.json --dry-run

# Routing operations (append-only evidence)
python -m codex.cli d365 apply-routing plan_routing.json --no-dry-run
```

Each command appends to `.codex/evidence/d365_slas.jsonl` or
`.codex/evidence/d365_routing.jsonl`, including commit SHA, Python version, and
OS metadata for offline audit review.
